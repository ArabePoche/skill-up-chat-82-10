
import React, { useState, useEffect, useRef } from 'react';
import { Smile, Heart, Sun, Coffee, Car, Flag, Music, Star } from 'lucide-react';

interface EmojiPickerProps {
  onEmojiSelect: (emoji: string) => void;
  isOpen: boolean;
  onToggle: () => void;
}

const EmojiPicker: React.FC<EmojiPickerProps> = ({ onEmojiSelect, isOpen, onToggle }) => {
  const [activeCategory, setActiveCategory] = useState('smileys');
  const pickerRef = useRef<HTMLDivElement>(null);

  useEffect(() => {
    const handleClickOutside = (event: MouseEvent) => {
      if (pickerRef.current && !pickerRef.current.contains(event.target as Node)) {
        onToggle();
      }
    };

    if (isOpen) {
      document.addEventListener('mousedown', handleClickOutside);
    }

    return () => {
      document.removeEventListener('mousedown', handleClickOutside);
    };
  }, [isOpen, onToggle]);

  const emojiCategories = {
    smileys: {
      icon: Smile,
      emojis: ['ðŸ˜€', 'ðŸ˜ƒ', 'ðŸ˜„', 'ðŸ˜', 'ðŸ˜†', 'ðŸ˜…', 'ðŸ˜‚', 'ðŸ¤£', 'ðŸ˜Š', 'ðŸ˜‡', 'ðŸ™‚', 'ðŸ™ƒ', 'ðŸ˜‰', 'ðŸ˜Œ', 'ðŸ˜', 'ðŸ¥°', 'ðŸ˜˜', 'ðŸ˜—', 'ðŸ˜™', 'ðŸ˜š', 'ðŸ˜‹', 'ðŸ˜›', 'ðŸ¤¨', 'ðŸ§', 'ðŸ¤“', 'ðŸ˜Ž', 'ðŸ¤©', 'ðŸ¥³', 'ðŸ¤”',' ðŸ¤—', 'ðŸ¤«', 'ðŸ«¢', 'ðŸ¤•' ]
    },
    emotions: {
      icon: Heart,
      emojis: ['â¤ï¸', 'ðŸ§¡', 'ðŸ’›', 'ðŸ’š', 'ðŸ’™', 'ðŸ’œ', 'ðŸ–¤', 'ðŸ¤', 'ðŸ¤Ž', 'ðŸ’”', 'â£ï¸', 'ðŸ’•', 'ðŸ’ž', 'ðŸ’“', 'ðŸ’—', 'ðŸ’–', 'ðŸ’˜', 'ðŸ’', 'ðŸ’Ÿ', 'â™¥ï¸', 'ðŸ’¯', 'ðŸ’¢', 'ðŸ’¥', 'ðŸ’«', 'ðŸ’¦', 'ðŸ’¨', 'ðŸ•³ï¸', 'ðŸ’£', 'ðŸ’¬', 'ðŸ‘ï¸â€ðŸ—¨ï¸', 'ðŸ—¨ï¸', 'ðŸ—¯ï¸', 'ðŸ’­']
    },
    nature: {
      icon: Sun,
      emojis: ['ðŸŒž', 'ðŸŒ', 'ðŸŒ›', 'ðŸŒœ', 'ðŸŒš', 'ðŸŒ•', 'ðŸŒ–', 'ðŸŒ—', 'ðŸŒ˜', 'ðŸŒ‘', 'ðŸŒ’', 'ðŸŒ“', 'ðŸŒ”', 'ðŸŒ™', 'â­', 'ðŸŒŸ', 'ðŸ’«', 'âœ¨', 'â˜„ï¸', 'â˜€ï¸', 'ðŸŒ¤ï¸', 'â›…', 'ðŸŒ¥ï¸', 'â˜ï¸', 'ðŸŒ¦ï¸', 'ðŸŒ§ï¸', 'â›ˆï¸', 'ðŸŒ©ï¸', 'ðŸŒ¨ï¸', 'â„ï¸', 'â˜ƒï¸', 'â›„']
    },
    food: {
      icon: Coffee,
      emojis: ['ðŸŽ', 'ðŸŠ', 'ðŸ‹', 'ðŸŒ', 'ðŸ‰', 'ðŸ‡', 'ðŸ“', 'ðŸˆ', 'ðŸ’', 'ðŸ‘', 'ðŸ¥­', 'ðŸ', 'ðŸ¥¥', 'ðŸ¥', 'ðŸ…', 'ðŸ†', 'ðŸ¥‘', 'ðŸ¥¦', 'ðŸ¥¬', 'ðŸ¥’', 'ðŸŒ¶ï¸', 'ðŸŒ½', 'ðŸ¥•', 'ðŸ§„', 'ðŸ§…', 'ðŸ¥”', 'ðŸ ', 'ðŸ¥', 'ðŸž', 'ðŸ¥–', 'ðŸ¥¨', 'ðŸ§€']
    },
    transport: {
      icon: Car,
      emojis: ['ðŸš—', 'ðŸš•', 'ðŸš™', 'ðŸšŒ', 'ðŸšŽ', 'ðŸŽï¸', 'ðŸš“', 'ðŸš‘', 'ðŸš’', 'ðŸš', 'ðŸ›»', 'ðŸšš', 'ðŸš›', 'ðŸšœ', 'ðŸï¸', 'ðŸ›µ', 'ðŸš²', 'ðŸ›´', 'ðŸ›¹', 'ðŸš', 'ðŸ›¸', 'âœˆï¸', 'ðŸ›©ï¸', 'ðŸ›«', 'ðŸ›¬', 'ðŸš€', 'ðŸ›°ï¸', 'ðŸ’º', 'ðŸš¢', 'â›µ', 'ðŸ›¶', 'ðŸš¤']
    },
    flags: {
      icon: Flag,
      emojis: ['ðŸ', 'ðŸš©', 'ðŸŽŒ', 'ðŸ´', 'ðŸ³ï¸', 'ðŸ‡§ðŸ‡«', 'ðŸ³ï¸â€ðŸŒˆ', 'ðŸ³ï¸â€âš§ï¸', 'ðŸ‡¬ðŸ‡³', 'ðŸ‡«ðŸ‡·', 'ðŸ‡ºðŸ‡¸', 'ðŸ‡¬ðŸ‡§', 'ðŸ‡©ðŸ‡ª', 'ðŸ‡ªðŸ‡¸', 'ðŸ‡®ðŸ‡¹', 'ðŸ‡¯ðŸ‡µ', 'ðŸ‡¨ðŸ‡³', 'ðŸ‡²ðŸ‡±', 'ðŸ‡¨ðŸ‡²', 'ðŸ‡°ðŸ‡·', 'ðŸ‡·ðŸ‡º', 'ðŸ‡§ðŸ‡·', 'ðŸ‡¨ðŸ‡¦', 'ðŸ‡¦ðŸ‡º', 'ðŸ‡®ðŸ‡³', 'ðŸ‡²ðŸ‡½', 'ðŸ‡³ðŸ‡±', 'ðŸ‡¸ðŸ‡ª', 'ðŸ‡³ðŸ‡´', 'ðŸ‡©ðŸ‡°', 'ðŸ‡«ðŸ‡®', 'ðŸ‡µðŸ‡±', 'ðŸ‡¨ðŸ‡­', 'ðŸ‡¦ðŸ‡¹']
    },
    music: {
      icon: Music,
      emojis: ['ðŸŽµ', 'ðŸŽ¶', 'ðŸŽ¼', 'ðŸŽ¤', 'ðŸŽ§', 'ðŸ“»', 'ðŸŽ™ï¸', 'ðŸ“¢', 'ðŸ“£', 'ðŸ“¯', 'ðŸ””', 'ðŸ”•', 'ðŸŽšï¸', 'ðŸŽ›ï¸', 'ðŸŽ¨', 'ðŸ–Œï¸', 'ðŸ–ï¸', 'ðŸ–Šï¸', 'ðŸ–‹ï¸', 'âœï¸', 'âœ’ï¸', 'ðŸ–‡ï¸', 'ðŸ“Ž', 'ðŸ”—']
    },
    symbols: {
      icon: Star,
      emojis: ['â­', 'ðŸŒŸ', 'ðŸ’«', 'âœ¨', 'ðŸ”¥', 'ðŸ’¥', 'ðŸ’¢', 'ðŸ’¯', 'ðŸ’¢', 'ðŸ’¥', 'ðŸ’«', 'ðŸ’¦', 'ðŸ’¨', 'ðŸ•³ï¸', 'ðŸ’£', 'ðŸ’¬', 'ðŸ‘ï¸â€ðŸ—¨ï¸', 'ðŸ—¨ï¸', 'ðŸ—¯ï¸', 'ðŸ’­', 'ðŸ’¤', 'ðŸ‘‹', 'ðŸ¤š', 'ðŸ–ï¸', 'âœ‹', 'ðŸ––', 'ðŸ‘Œ', 'ðŸ¤Œ', 'ðŸ¤', 'âœŒï¸', 'ðŸ¤ž', 'ðŸ‘',  'âœï¸', 'ðŸ¤', 'ðŸ’ª', 'ðŸ‘†', 'ðŸ‘‡', 'ðŸ‘', 'ðŸ¤²', 'ðŸ«¶', 'ðŸ‘‚', 'ðŸ‘€' ]
    }
  };

  if (!isOpen) return null;

  const handleEmojiSelect = (emoji: string) => {
    onEmojiSelect(emoji);
    onToggle();
  };

  return (
    <div ref={pickerRef} className="bg-white border border-gray-200 rounded-lg shadow-lg w-80 max-h-72">
      {/* Categories */}
      <div className="flex border-b border-gray-200 bg-gray-50 rounded-t-lg">
        {Object.entries(emojiCategories).map(([key, category]) => {
          const IconComponent = category.icon;
          return (
            <button
              key={key}
              type="button"
              onClick={() => setActiveCategory(key)}
              className={`flex-1 p-2 text-center hover:bg-gray-100 first:rounded-tl-lg last:rounded-tr-lg ${
                activeCategory === key ? 'bg-blue-100 text-blue-600' : 'text-gray-600'
              }`}
            >
              <IconComponent size={16} className="mx-auto" />
            </button>
          );
        })}
      </div>
      
      {/* Emojis Grid */}
      <div className="p-3 max-h-48 overflow-y-auto">
        <div className="grid grid-cols-8 gap-1">
          {emojiCategories[activeCategory as keyof typeof emojiCategories].emojis.map((emoji, index) => (
            <button
              key={index}
              type="button"
              onClick={() => handleEmojiSelect(emoji)}
              className="w-8 h-8 flex items-center justify-center text-lg hover:bg-gray-100 rounded transition-colors"
              title={emoji}
            >
              {emoji}
            </button>
          ))}
        </div>
      </div>
    </div>
  );
};

export default EmojiPicker;
